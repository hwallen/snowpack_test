prec_sd = sd(precipitation))
df_main %>%
filter(precipitation > 0) %>%
group_by(year, month) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation))
read_delim(here("data", "weather", "tahtela", "meteo", "tahtela_daily2000_2023.csv"),
delim = ";",
na = c("", "NA", "-")) %>%
clean_names() %>%
filter(month %in% c(11,12,01,02,03,04))
read_delim(here("data", "weather", "tahtela", "meteo", "tahtela_daily2000_2023.csv"),
delim = ";",
na = c("", "NA", "-")) %>%
clean_names() %>%
filter(month %in% c(11,12,01,02,03,04)) %>% map(summary)
read_delim(here("data", "weather", "tahtela", "meteo", "tahtela_daily2000_2023.csv"),
delim = ";",
na = c("", "NA", "-")) %>%
clean_names()
read_delim(here("data", "weather", "tahtela", "meteo", "tahtela_daily2000_2023.csv"),
delim = ";",
na = c("", "NA", "-")) %>%
clean_names() %>%
filter(month %in% c("11","12", "1", "2"))
read_delim(here("data", "weather", "tahtela", "meteo", "tahtela_daily2000_2023.csv"),
delim = ";",
na = c("", "NA", "-")) %>%
clean_names() %>%
filter(month %in% c("11","12", "01", "2"))
read_delim(here("data", "weather", "tahtela", "meteo", "tahtela_daily2000_2023.csv"),
delim = ";",
na = c("", "NA", "-")) %>%
clean_names() %>%
filter(month %in% c("11","12", "01", "02", "03", "04")) %>%
mutate(timestamp = ymd_hms(paste0(year, "-", month, "-", day,"-", time_local_time)),
snow_depth_cm = case_when(snow_depth_cm == -1 ~ 0,
.default = snow_depth_cm),
precipitation_amount_mm = case_when(precipitation_amount_mm == -1 ~ 0,
.default = precipitation_amount_mm),
observation_station = "T채htel채",
year = factor(year),
month = factor(as.double(month)),
day = factor(as.double(day)),
.keep = "unused") %>%
rename("snowdepth" = "snow_depth_cm",
"precipitation" = "precipitation_amount_mm",
"temp_avg" = "average_temperature_c",
"station" = "observation_station") %>%
relocate(station,timestamp)
df_main <- read_delim(here("data", "weather", "tahtela", "meteo", "tahtela_daily2000_2023.csv"),
delim = ";",
na = c("", "NA", "-")) %>%
clean_names() %>%
filter(month %in% c("11","12", "01", "02", "03", "04")) %>%
mutate(timestamp = ymd_hms(paste0(year, "-", month, "-", day,"-", time_local_time)),
snow_depth_cm = case_when(snow_depth_cm == -1 ~ 0,
.default = snow_depth_cm),
precipitation_amount_mm = case_when(precipitation_amount_mm == -1 ~ 0,
.default = precipitation_amount_mm),
observation_station = "T채htel채",
year = factor(year),
month = factor(as.double(month)),
day = factor(as.double(day)),
.keep = "unused") %>%
rename("snowdepth" = "snow_depth_cm",
"precipitation" = "precipitation_amount_mm",
"temp_avg" = "average_temperature_c",
"station" = "observation_station") %>%
relocate(station,timestamp)
df_main %>%
filter(snowdepth > 0) %>%
ggplot(aes(x = snowdepth)) +
geom_histogram(binwidth = 1, color = "snow") +
theme_clean()
df_main %>%
filter(precipitation > 0) %>%
ggplot(aes(x = precipitation)) +
geom_histogram(color = "snow", bins = 30) +
theme_clean()
df_main %>%
filter(precipitation > 0) %>%
group_by(year, month) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation
df_main %>%
filter(precipitation > 0) %>%
group_by(year, month) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation))
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation))
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation)) %>% map(summary)
df_main %>%
filter(precipitation > 0) %>%
ggplot(aes(x = precipitation)) +
geom_histogram(color = "snow", bins = 30) +
theme_clean()
df_main %>%
filter(precipitation > 0) %>%
ggplot(aes(x = log(precipitation))) +
geom_histogram(color = "snow", bins = 30) +
theme_clean()
df_main %>%
filter(precipitation > 0) %>%
ggplot(aes(x = precipitation)) +
geom_histogram(color = "snow", bins = 30) +
theme_clean()
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation))
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation)) %>% ggplot(aes(x=year, y = prec_sd)) + geom_col()
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation)) %>% ggplot(aes(x=year, y = prec_sd)) + geom_col() + geom_smooth(method = "lm")
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation)) %>% ggplot(aes(x=year, y = prec_sd)) + geom_col() + geom_smooth()
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation)) %>% ggplot(aes(x=year, y = prec_sd)) + geom_smooth()
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation)) %>% ggplot(aes(x=year, y = prec_sd)) + geom_col() + geom_smooth()
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation)) %>% ggplot(aes(x=year, y = prec_sd)) + geom_point() + geom_smooth()
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation)) %>% ggplot(aes(x=year, y = prec_sd)) + geom_point() + geom_smooth(method = "lm")
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation)) %>% ggplot(aes(x=year, y = prec_sd)) + geom_point() -> p_testi
p_testi
p_testi + geom_smooth()
p_testi + geom_smooth(color ="red")
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation)) %>% ggplot(aes(x=as.integer(year), y = prec_sd)) + geom_point()
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation)) %>% ggplot(aes(x=as.integer(year), y = prec_sd)) + geom_point() + geom_smooth()
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation)) %>% ggplot(aes(x=as.integer(year), y = prec_sd)) + geom_point() + geom_smooth(method = "lm")
df_main %>%
filter(precipitation > 0) %>%
ggplot(aes(x = precipitation)) +
geom_histogram(color = "snow", bins = 30) +
theme_clean()
dfmodel <- df_main %>%
filter(precipitation > 0)
bf(precipitation ~ 1)
mod.pois <- brm(formula = fsimple_prec_pois,
data = dfmodel,
backend = "cmdstanr",
iter = 3000, warmup = 1500,
chains = 4, cores = 4)
fsimple_prec_pois <- bf(precipitation ~ 1) + poisson()
mod.pois <- brm(formula = fsimple_prec_pois,
data = dfmodel,
backend = "cmdstanr",
iter = 3000, warmup = 1500,
chains = 4, cores = 4)
fsimple_prec_geo <- bf(precipitation ~ 1) + geometric()
mod.geo <- brm(formula = fsimple_prec_geo,
data = dfmodel,
backend = "cmdstanr",
iter = 3000, warmup = 1500,
chains = 4, cores = 4)
fsimple_prec_gamma <- bf(precipitation ~ 1) + Gamma(link = "log")
mod.geo <- brm(formula = fsimple_prec_gamma,
data = dfmodel,
backend = "cmdstanr",
iter = 3000, warmup = 1500,
chains = 4, cores = 4)
mod.geo
mod.geo %>% pp_check()
dfmodel
modr.gamma <- brm(formula = fran_prec_gamma,
data = dfmodel,
backend = "cmdstanr",
iter = 3000, warmup = 1500,
chains = 4, cores = 4,
silent = 0)
fran_prec_gamma <- bf(precipitation ~ 1 + (1 | year)) + Gamma(link = "log")
modr.gamma <- brm(formula = fran_prec_gamma,
data = dfmodel,
backend = "cmdstanr",
iter = 3000, warmup = 1500,
chains = 4, cores = 4,
silent = 0)
modr.gamma
modr.gamma %>% pp_check()
loo(mod.geo, modr.gamma)
library(tidybayes)
install.packages("tidybayes")
library(tidybayes)
modr.gamma %>%
epred_draws()
posterior_samples(modr.gamma)
posterior_samples(modr.gamma) %>% as_tibble()
posterior_samples(modr.gamma) %>% tidy()
modr.gamma %>%
spread_draws(b_Intercept)
modr.gamma %>%
spread_draws(b_Intercept, shape)
as.matrix(modr.gamma)
as.matrix(modr.gamma) %>% as_tibble()
modr.gamma %>%
spread_draws(b_Intercept)
modr.gamma %>%
spread_draws(b_Intercept) %>%
summarise(prec_mean = mean(b_Intercept),
prec_sd = sd(b_Intercept))
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation))
df_main %>%
filter(precipitation > 0) %>%
group_by(year) %>%
summarise(prec_mean = mean(precipitation),
prec_median = median(precipitation),
prec_sd = sd(precipitation)) %>% summarise(prec_mean = mean(prec_mean), prec_sd = sd(prec_sd))
modr.gamma %>%
spread_draws(b_Intercept) %>%
summarise(prec_mean = mean(b_Intercept),
prec_sd = sd(b_Intercept))
mod.geo %>%
spread_draws(b_Intercept)
mod.geo %>%
spread_draws(b_Intercept) %>%
summarise(prec_mean = mean(b_Intercept),
prec_sd = sd(b_Intercept))
as.matrix(modr.gamma) %>% as_tibble()
library(bayesplot)
mcmc_areas(modr.gamma)
mcmc_areas(modr.gamma, pars = vars(contains("b_Intercept")))
mod.geo %>%
spread_draws(b_Intercept)
modr.gamma %>%
spread_draws(b_Intercept, r_year[year])
modr.gamma %>%
spread_draws(b_Intercept, r_year[1:5,)
modr.gamma %>%
spread_draws(b_Intercept, r_year[1:5,]
modr.gamma %>%
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,])
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year)
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean))
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean)) +
stat_halfeye()
?stat_halfeye
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean)) +
stat_halfeye(p_limits = c(0.1, 0.9))
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean)) +
stat_halfeye(.width = c(0.9, 0.975))
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean)) +
stat_halfeye(.width = c(0.8, 0.975))
library(ggokabeito)
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean)) +
stat_halfeye(.width = c(0.8, 0.975)) +
scale_fill_okabe_ito()
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean, fill = prec_mean)) +
stat_halfeye(.width = c(0.8, 0.975))
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean, color = prec_mean)) +
stat_halfeye(.width = c(0.8, 0.975))
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean, color = prec_mean)) +
stat_halfeye(.width = c(0.8, 0.975)) +
scale_fill_okabe_ito()
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean, fill = prec_mean)) +
stat_halfeye(.width = c(0.8, 0.975)) +
scale_fill_okabe_ito()
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean, fill = after_stat(abs(prec_mean) < .8)))
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean, fill = after_stat(abs(x) < .8))) +
stat_halfeye(.width = c(0.8, 0.975))
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean, fill = after_stat(abs(x) < .8))) +
geom_slabinterval()
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean)) +
geom_slabinterval()
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean)) +
stat_slabinterval(.width = c(0.8, 0.975))
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean)) +
stat_slabinterval(.width = c(0.8, 0.975),
slab_fill ="green")
?scale_fill_okabe_ito
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean)) +
stat_slabinterval(.width = c(0.8, 0.975),
slab_fill ="#F0E442")
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = b_Intercept + r_year) %>%
ggplot(aes(x = prec_mean)) +
stat_slabinterval(.width = c(0.8, 0.975),
slab_fill ="#F0E442") +
theme_clean()
dfmodel
read_delim(here("data", "weather", "tahtela", "meteo", "tahtela_daily2000_2023.csv"),
delim = ";",
na = c("", "NA", "-")) %>%
clean_names()
mod.geo %>%
spread_draws(b_Intercept) %>%
summarise(prec_mean = mean(b_Intercept),
prec_sd = sd(b_Intercept))
mod.geo %>%
spread_draws(b_Intercept) %>%
summarise(prec_mean = mean(b_Intercept),
prec_sd = sd(b_Intercept),
prec_max = max(b_Intercept))
read_delim(here("data", "weather", "tahtela", "meteo", "tahtela_daily2000_2023.csv"),
delim = ";",
na = c("", "NA", "-")) %>%
clean_names()
read_delim(here("data", "weather", "tahtela", "meteo", "tahtela_daily2000_2023.csv"),
delim = ";",
na = c("", "NA", "-")) %>%
clean_names() %>% map(summary)
modr.gamma
log(0.65)
exp(0.65)
mod.geo %>%
spread_draws(b_Intercept)
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = exp(b_Intercept) + exp(r_year)) %>%
ggplot(aes(x = prec_mean)) +
stat_slabinterval(.width = c(0.8, 0.975),
slab_fill ="#F0E442") +
theme_clean() +
labs(y = NULL,
x = "Precipitation",
title = )
mod.geo %>%
spread_draws(b_Intercept) %>%
mutate(b_Intercept = exp(b_Intercept))
mod.geo %>%
spread_draws(b_Intercept) %>%
mutate(b_Intercept = exp(b_Intercept)) %>%
summarise(prec_mean = mean(b_Intercept),
prec_sd = sd(b_Intercept),
prec_max = max(b_Intercept))
fran_prec_wei <- bf(precipitation ~ 1 + (1 | year)) + weibull(link = "log")
modr.wei <- brm(formula = fran_prec_wei,
data = dfmodel,
backend = "cmdstanr",
iter = 3000, warmup = 1500,
chains = 4, cores = 4,
silent = 0)
modr.wei
modr.wei %>% pp_check()
modr.wei %>% pp_check(ndraws = 100)
modr.gamma %>% pp_check(ndraws = 100)
loo(modr.wei, modr.gamma)
fran_prec_ext <- bf(precipitation ~ 1 + (1 | year)) + gen_extreme_value()
modr.ext <- brm(formula = fran_prec_ext,
data = dfmodel,
backend = "cmdstanr",
iter = 3000, warmup = 1500,
chains = 4, cores = 4,
silent = 0)
modr.ext
modr.ext %>% pp_check(ndraws = 100)
loo(modr.wei, modr.gamma, modr.ext)
modr.wei %>%
spread_draws(b_Intercept) %>%
summarise(prec_mean = mean(b_Intercept),
prec_sd = sd(b_Intercept))
modr.gamma %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = exp(b_Intercept) + exp(r_year)) %>%
ggplot(aes(x = prec_mean)) +
stat_slabinterval(.width = c(0.8, 0.975),
slab_fill ="#F0E442") +
theme_clean() +
labs(y = NULL,
x = "Precipitation",
title = "gmm: Weibull - Precipitation")
modr.wei %>%
spread_draws(b_Intercept, r_year[year,]) %>%
mutate(prec_mean = exp(b_Intercept) + exp(r_year)) %>%
ggplot(aes(x = prec_mean)) +
stat_slabinterval(.width = c(0.8, 0.975),
slab_fill ="#F0E442") +
theme_clean() +
labs(y = NULL,
x = "Precipitation",
title = "gmm: Weibull - Precipitation")
modr.wei %>%
spread_draws(b_Intercept) %>%
mutate(b_Intercept = exp(b_Intercept)) %>%
summarise(prec_mean = mean(b_Intercept),
prec_sd = sd(b_Intercept),
prec_max = max(b_Intercept))
modr.wei %>%
spread_draws(b_Intercept)
modr.wei %>%
spread_draws(b_Intercept) %>%
mutate(b_Intercept = exp(b_Intercept))
modr.wei %>%
spread_draws(b_Intercept) %>%
mutate(b_Intercept = exp(b_Intercept)) %>%
summarise(prec_mean = mean(b_Intercept),
prec_sd = sd(b_Intercept),
prec_max = max(b_Intercept))
